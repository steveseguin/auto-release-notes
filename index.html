<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Commit Summary</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        /* Remove this */
        /*
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        input {
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0256c7;
        }
        */
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            display: none;
        }
        .error {
            color: #d73a49;
            margin-top: 10px;
        }
        .info {
            color: #666;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GitHub Commit Summary</h1>
        <div id="repo-info" class="info"></div>
        <div id="error" class="error"></div>
        <div id="output"></div>
        
        <h2>Command Line Method</h2>
        <pre style="background: #f8f8f8; padding: 15px; border-radius: 4px; overflow-x: auto;">
# Get commits from last 2 weeks with formatting
git log --since="2 weeks ago" --pretty=format:"- %s%n  %b" | grep -v "^$"

# Alternative with more details
git log --since="2 weeks ago" --pretty=format:"- **%s**%n  Author: %an%n  Date: %ad%n  %b%n" --date=short

# Group by author
git log --since="2 weeks ago" --pretty=format:"%an|%s|%b" | sort | awk -F'|' '{
    if ($1 != prev) {
        if (prev) print ""
        print "### " $1
        prev = $1
    }
    print "- " $2
    if ($3) print "  " $3
}'
        </pre>
    </div>

    <script>
        // Replace this entire script block
        /*
        async function fetchCommits() {
            const owner = document.getElementById('owner').value;
            const repo = document.getElementById('repo').value;
            const token = document.getElementById('token').value;
            const errorDiv = document.getElementById('error');
            const outputDiv = document.getElementById('output');
            
            errorDiv.textContent = '';
            outputDiv.style.display = 'none';
            
            if (!owner || !repo) {
                errorDiv.textContent = 'Please enter both owner and repository name';
                return;
            }
            
            const twoWeeksAgo = new Date();
            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
            const since = twoWeeksAgo.toISOString();
            
            const headers = {
                'Accept': 'application/vnd.github.v3+json'
            };
            
            if (token) {
                headers['Authorization'] = `token ${token}`;
            }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/commits?since=${since}&per_page=100`,
                    { headers }
                );
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                }
                
                const commits = await response.json();
                
                if (commits.length === 0) {
                    outputDiv.textContent = 'No commits found in the last 2 weeks';
                    outputDiv.style.display = 'block';
                    return;
                }
                
                const summary = formatCommitSummary(commits);
                outputDiv.textContent = summary;
                outputDiv.style.display = 'block';
                
            } catch (error) {
                errorDiv.textContent = `Error: ${error.message}`;
            }
        }
        
        function formatCommitSummary(commits) {
            const features = [];
            const fixes = [];
            const other = [];
            
            commits.forEach(commit => {
                const message = commit.commit.message;
                const firstLine = message.split('\n')[0];
                const body = message.split('\n').slice(1).join('\n').trim();
                
                const entry = body ? `- ${firstLine}\n  ${body.replace(/\n/g, '\n  ')}` : `- ${firstLine}`;
                
                if (firstLine.toLowerCase().match(/^(feat|feature|add)/)) {
                    features.push(entry);
                } else if (firstLine.toLowerCase().match(/^(fix|bugfix|patch)/)) {
                    fixes.push(entry);
                } else {
                    other.push(entry);
                }
            });
            
            let output = `# Updates from the last 2 weeks (${commits.length} commits)\n\n`;
            
            if (features.length > 0) {
                output += `## New Features\n${features.join('\n')}\n\n`;
            }
            
            if (fixes.length > 0) {
                output += `## Bug Fixes\n${fixes.join('\n')}\n\n`;
            }
            
            if (other.length > 0) {
                output += `## Other Changes\n${other.join('\n')}\n\n`;
            }
            
            output += `\n## Summary by Author\n`;
            const byAuthor = {};
            commits.forEach(commit => {
                const author = commit.commit.author.name;
                if (!byAuthor[author]) byAuthor[author] = 0;
                byAuthor[author]++;
            });
            
            Object.entries(byAuthor)
                .sort((a, b) => b[1] - a[1])
                .forEach(([author, count]) => {
                    output += `- ${author}: ${count} commits\n`;
                });
            
            return output;
        }
        */
        // End Replace

        // Add this here
        (async () => {
            const owner = window.GITNFO_OWNER;
            const repo = window.GITNFO_REPO;
            const branch = window.GITNFO_BRANCH || 'main'; // Default to 'main' if not provided
            const errorDiv = document.getElementById('error');
            const outputDiv = document.getElementById('output');
            const repoInfoDiv = document.getElementById('repo-info');
            
            errorDiv.textContent = '';
            outputDiv.style.display = 'none';

            if (!owner || !repo) {
                repoInfoDiv.textContent = 'Please navigate to gitnfo.com/owner/repo to view commit history.';
                return;
            }

            repoInfoDiv.textContent = `Displaying commits for: ${owner}/${repo}${branch !== 'main' ? ` (branch: ${branch})` : ''}`;
            
            const twoWeeksAgo = new Date();
            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
            const since = twoWeeksAgo.toISOString();
            
            const headers = {
                'Accept': 'application/vnd.github.v3+json'
            };
            
            // You might consider adding a way for users to provide a token for private repos
            // For now, it's removed as per original prompt context, but kept for future reference
            // const token = localStorage.getItem('githubToken'); // Example: store token in localStorage
            // if (token) {
            //     headers['Authorization'] = `token ${token}`;
            // }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/commits?since=${since}&per_page=100&sha=${branch}`,
                    { headers }
                );
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`GitHub API error: ${response.status} ${response.statusText} - ${errorData.message}`);
                }
                
                const commits = await response.json();
                
                if (commits.length === 0) {
                    outputDiv.textContent = 'No commits found in the last 2 weeks for this repository/branch.';
                    outputDiv.style.display = 'block';
                    return;
                }
                
                const summary = formatCommitSummary(commits);
                outputDiv.textContent = summary;
                outputDiv.style.display = 'block';
                
            } catch (error) {
                errorDiv.textContent = `Error: ${error.message}`;
            }
        })(); // Self-invoking function to run on page load

        function formatCommitSummary(commits) {
            const features = [];
            const fixes = [];
            const other = [];
            
            commits.forEach(commit => {
                const message = commit.commit.message;
                const firstLine = message.split('\n')[0];
                const body = message.split('\n').slice(1).join('\n').trim();
                
                const entry = body ? `- ${firstLine}\n  ${body.replace(/\n/g, '\n  ')}` : `- ${firstLine}`;
                
                if (firstLine.toLowerCase().match(/^(feat|feature|add)/)) {
                    features.push(entry);
                } else if (firstLine.toLowerCase().match(/^(fix|bugfix|patch)/)) {
                    fixes.push(entry);
                } else {
                    other.push(entry);
                }
            });
            
            let output = `# Updates from the last 2 weeks (${commits.length} commits)\n\n`;
            
            if (features.length > 0) {
                output += `## New Features\n${features.join('\n')}\n\n`;
            }
            
            if (fixes.length > 0) {
                output += `## Bug Fixes\n${fixes.join('\n')}\n\n`;
            }
            
            if (other.length > 0) {
                output += `## Other Changes\n${other.join('\n')}\n\n`;
            }
            
            output += `\n## Summary by Author\n`;
            const byAuthor = {};
            commits.forEach(commit => {
                const author = commit.commit.author.name;
                if (!byAuthor[author]) byAuthor[author] = 0;
                byAuthor[author]++;
            });
            
            Object.entries(byAuthor)
                .sort((a, b) => b[1] - a[1])
                .forEach(([author, count]) => {
                    output += `- ${author}: ${count} commits\n`;
                });
            
            return output;
        }
        // End Add
    </script>
</body>
</html>
